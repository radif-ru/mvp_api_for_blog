# MVP API для блога (тестовое задание, DRF использовать запрещено)

## Запуск

> Запуск `prod` версии
> `docker-compose -f docker-compose.prod.yml up -d --build --remove-orphans`
>
> Запуск `dev` версии
> `docker-compose -f docker-compose.prod.yml up -d --build --remove-orphans`
> 
> Флаг `-d` можно убрать для запуска не в фоне, так же если нет необходимости,
> можно убрать `--remove-orphans`.

### Описание

> В `prod` версии порты не проброшены наружу, в отличие от `dev` -
> здесь использую для локальных тестов.
> Сразу работал с веткой `dev`, так как один, затем мержил через пул реквест в
> `main`.
>
> В `dev` версии после запуска автоматически создадутся пользователи,
> пароли будут одинаковые, для удобного тестирования: `qwertytwerq`,
> но токены сгенерируются рандомно, пользователи: `admin` (
> админ), `olya`, `ivan`.
> Так же к пользователям рандомно прикрепятся статьи,
> а к статьям рандомные комментарии с рандомными авторами.
> Каждый пользователь получит рандомный токен - можно посмотреть в админ
> панели.
>
> Так же данные можно заполнить самостоятельно как в `prod`, так и в `dev`.
> Для этого нужно зайти в запущенный контейнер: 
> `docker exec -it <CONTAINER ID or NAME> sh` и выполнить специальные команды.
> Подробнее в разделе "Пользовательские команды".
> 
> Если и `prod` и `dev` в одной системе, `volumes` нужно назвать по-разному!
>
> Контейнеры на перезапуске, если не нужно - отключить.
>
> Токен необходимо указывать в заголовке (`headers`) `Authorization` -
> используется для аутентификации пользователя.

### Пользовательские команды

> Выполнять из каталога `app`
> 
> `python manage.py add_all_data` - Подготовка и выполнение миграций. 
> Сборка стандартных и подготовленных статических файлов. 
> Сборка всех подготовленных данных в БД, 
> для таблиц `users`, `articles`, `comments` из файлов, 
> которые хранятся в `./app/files/json`. 
> К создаваемым пользователям рандомно прикрепляются статьи,
> а к статьям генерируются рандомные комментарии с рандомными авторами, 
> данные связываются только с существующими.
>
> `python manage.py add_user` - Создание пользователя или админа.
> Принимает аргументы: `username`, `password`, `is_superuser`
> (не обязательный, по умолчанию `False`)
>
> `python manage.py add_article` - Создание статьи со случайным автором 
> или с точным указанием.
> Если автор не указан - будет присвоен случайно из существующих в БД.
> Принимает аргументы: `title` (заголовки должны различаться), 
> `text`, `author_id` (не обязательный)
>
> `python manage.py add_comment` - Создание комментария со случайным автором к
> случайной статье или с точным указанием. 
> Если пользователь или статья не указаны - будут присвоены 
> случайно из существующих в БД.
> Принимает аргументы: `text`, `user_id` (не обязательный), 
> `article_id` (не обязательный)

## API

### CRUD операции со статьями

> Endpoint: http://127.0.0.1/api/articles

#### Методы и права пользователей

> `GET` - Получить все статьи или статью с комментариями по переданному
> идентификатору в параметре `id`.
>
> `POST` - Создать статью.
> Обязательные поля в теле запроса (`JSON`-формат):
> `title`, `text`.
> Возвращает сообщение с результатом и описание ошибки (если есть).
>
> `PATCH` - Редактировать статью.
> Обычному пользователю можно редактировать только свои статьи.
> Админу можно редактировать любые статьи.
> В теле запроса (`JSON`-формат)
> необходимо указать поле `title` или `text`.
> Возвращает сообщение с результатом и описание ошибки (если есть).
>
> `DELETE` - Удалить статью (перенести в архив).
> Обычному пользователю можно удалять только свои статьи.
> Админу можно удалять любые статьи.
> В теле запроса (`JSON`-формат)
> необходимо указать поле `id` - идентификатор статьи.
> Возвращает сообщение с результатом и описание ошибки (если есть).

> Дополнительно возвращают соответсвующее статус-коды и описания статусов.

## Запуск тестов

> `python manage.py test` - запускать в каталоге `app`


### Работа с токенами

> Endpoint: http://127.0.0.1/api/token

#### Методы и права пользователей

> `POST` - Создать токен.
> Генерирует новый токен, в теле запроса (`JSON`-формат)
> необходимо передать `username` и `password`.
> В случае успешной идентификации пользователя
> возвращает сообщение с результатом, сгенерированный token` и его `id`.
> В случае ошибки возвращает её описание.
>
> `DELETE` - Удалить токен (перенести в архив).
> Токен должен быть указан в заголовке (`headers`) `Authorization`.
> Обычному пользователю можно удалить только текущий токен - по которому он
> аутентифицируется.
> Админ может удалить любой токен, для этого нужно передать в теле
> запроса (`JSON`-формат)
> `token` (токен) или `id` (идентификатор).
> Возвращает результат выполнения и описание ошибки (если есть).

> Дополнительно возвращают соответсвующее статус-коды и описания статусов.

# Задание

Разработать MVP API для блога.

## Описание:

    Система содержит статьи (Articles) комментарии (Comments),  пользователей (Users), 
    а также токены для работы по API (авторизация по Token). 
    В системе должна быть возможность создать User, Token, Comment  (через админку или API). 

### API для CRUD операций:

    1. Получить все статьи
    2. Получить статью с комментариями (по ID)
    3. Создать статью
    4. Изменить статью
    5. Удалить статью (перенести в архив)

### Описание модели User (в Джанго можно использовать стандартную):

    username - ник автора (уникальный)
    is_superuser (boolean) - параметр администратор или нет
    date_joined - дата когда пользователь появился в системе
    is_active (boolean) - параметр для деактивации юзеров
    
    Администратор (is_superuser) имеет доступ ко всем статьям, может изменять/архивировать любую статью. 
    Пользователь - может изменять/архивировать только свои статьи.
    
    Читать статьи, может любой авторизованный и неавторизованный пользователь. 

### Аутентификация

    Работает по токенам (Token).  
    Выданный токен работает до момента пока его не отключат. 
    Несколько токенов у одного пользователя одновременно могут существовать.

### Дополнительно

    1. Упаковать приложение в докер
    2. Написать тесты на ручки
    3. Создать фикстуры или команду для наполнения БД тестовыми данными.
    4. Инструкцию для поднятия системы.

### Что использовать:

    - Бекенд - FastAPI или Django (нельзя использовать DRF)
    - База данных: PostgreSQL
